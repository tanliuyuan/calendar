<!DOCTYPE html>
<html>

<head>
<title>Weather Widget</title>

<!-- CSS -->
<link rel="stylesheet" type="text/css" href="http://classes.engineering.wustl.edu/cse330/content/weather.css">
<!-- END CSS -->

<!-- JS -->
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", fetchWeather, false);

function fetchWeather() {
	// Make AJAX request.
	var xmlHttp = new XMLHttpRequest();
	xmlHttp.open("GET", "http://classes.engineering.wustl.edu/cse330/content/weather_json.php", true);
	xmlHttp.addEventListener("load", parseResponse, false);
	xmlHttp.send(null);
}

function parseResponse(event){
	var weatherData = JSON.parse(event.target.responseText);
	document.getElementById("weatherWidget").getElementsByClassName("weather-loc")[0].innerHTML += "<strong>" + weatherData.location.city + " </strong>" + weatherData.location.state;
	document.getElementById("weatherWidget").getElementsByClassName("weather-humidity")[0].innerHTML += weatherData.atmosphere.humidity;
	document.getElementById("weatherWidget").getElementsByClassName("weather-temp")[0].innerHTML += weatherData.current.temp;
	document.getElementById("weatherWidget").getElementsByClassName("weather-tomorrow")[0].setAttribute("src", "http://us.yimg.com/i/us/nws/weather/gr/"+ weatherData.tomorrow.code +"ds.png");
	document.getElementById("weatherWidget").getElementsByClassName("weather-dayaftertomorrow")[0].setAttribute("src", "http://us.yimg.com/i/us/nws/weather/gr/"+ weatherData.dayafter.code +"ds.png");
}

</script>
<!-- END JS -->
</head>

<body>
	<div class="weather" id="weatherWidget">
		<div class="weather-loc"></div>
		<div class="weather-humidity"></div>
		<div class="weather-temp"></div>
		<img class="weather-tomorrow" />
		<img class="weather-dayaftertomorrow" />
		<div>
			<button id="update">Update</button>
		</div>
		<script>
			document.getElementById("update").addEventListener("click", fetchWeather(), false);
		</script>
	</div>
</body>

</html>